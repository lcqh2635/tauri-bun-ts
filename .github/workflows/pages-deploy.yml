# ä»¥ä¸‹å†…å®¹å‚è€ƒè‡ª https://github.com/JamesIves/github-pages-deploy-action
# https://github.com/yanglbme/gitee-pages-action


# https://zhuanlan.zhihu.com/p/663023274


# å·¥ä½œæµåç§°ï¼šåœ¨ GitHub Actions ä¸­æ˜¾ç¤ºä¸º "publish"
# è¯´æ˜ï¼šè¿™æ˜¯è¯¥ CI/CD å·¥ä½œæµçš„åç§°ï¼Œä¼šåœ¨ GitHub çš„ Actions æ ‡ç­¾é¡µä¸­æ˜¾ç¤ºã€‚
name: Build and Deploy

on:
  push:
#    branches:
#      - release
    tags:
      - v*
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4
        # æ­¤ç¤ºä¾‹é¡¹ç›®æ˜¯ä½¿ç”¨ npm æ„å»ºçš„ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ° 'build' æ–‡ä»¶å¤¹ã€‚æ›¿æ¢ä¸ºæ„å»ºé¡¹ç›®æ‰€éœ€çš„å‘½ä»¤ï¼Œæˆ–è€…å¦‚æœæ‚¨çš„ç«™ç‚¹æ˜¯é¢„æ„å»ºçš„ï¼Œåˆ™å®Œå…¨åˆ é™¤æ­¤æ­¥éª¤ã€‚
      - name: Install and Build
        run: |
          npm ci
          npm run build

        # ä½¿ç”¨ GitHub Action è‡ªåŠ¨éƒ¨ç½² Github Pagesï¼Œå°†æ–‡æ¡£äº§ç‰©æäº¤åˆ°gh-pagesåˆ†æ”¯
        # https://github.com/JamesIves/github-pages-deploy-action
      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: build # ä½œåº”éƒ¨ç½²çš„æ–‡ä»¶å¤¹ã€‚

        # ä½¿ç”¨ GitHub Action è‡ªåŠ¨éƒ¨ç½² Gitee Pages
        # å®˜æ–¹æ–‡æ¡£ https://github.com/yanglbme/gitee-pages-action
      - name: Sync to Gitee
        uses: wearerequired/git-mirror-action@master
        env:
          # cat ~/.ssh/id_rsa | wl-copy
          # æ³¨æ„åœ¨ Settings -> Secrets é…ç½® GITEE_RSA_PRIVATE_KEY
          SSH_PRIVATE_KEY: ${{ secrets.GITEE_RSA_PRIVATE_KEY }}
        with:
          # æ³¨æ„æ›¿æ¢ä¸ºä½ çš„ GitHub æºä»“åº“åœ°å€
          source-repo: git@github.com:lcqh2635/tauri-bun-ts.git
          # æ³¨æ„æ›¿æ¢ä¸ºä½ çš„ Gitee ç›®æ ‡ä»“åº“åœ°å€
          destination-repo: git@gitee.com:lcqh2635/tauri-bun-ts.git
      - name: Build Gitee Pages
        uses: yanglbme/gitee-pages-action@main
        with:
          # æ³¨æ„æ›¿æ¢ä¸ºä½ çš„ Gitee ç”¨æˆ·å
          gitee-username: lcqh2635
          # æ³¨æ„åœ¨ Settings -> Secrets é…ç½® GITEE_PASSWORD
          gitee-password: ${{ secrets.GITEE_PASSWORD }}
          # æ³¨æ„æ›¿æ¢ä¸ºä½ çš„ Gitee ä»“åº“ï¼Œä»“åº“åä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼Œè¯·å‡†ç¡®å¡«å†™ï¼Œå¦åˆ™ä¼šå‡ºé”™
          gitee-repo: lcqh2635/tauri-bun-ts
          # è¦éƒ¨ç½²çš„åˆ†æ”¯ï¼Œé»˜è®¤æ˜¯ masterï¼Œè‹¥æ˜¯å…¶ä»–åˆ†æ”¯ï¼Œåˆ™éœ€è¦æŒ‡å®šï¼ˆæŒ‡å®šçš„åˆ†æ”¯å¿…é¡»å­˜åœ¨ï¼‰
          branch: release


# 1ã€åœ¨ GitHub é¡¹ç›®çš„ Settings -> Pages è·¯å¾„ä¸‹é…ç½® Build and deploymentï¼Œsourceé€‰Deploy from a branchï¼Œbranché€‰æ‹©gh-pagesï¼Œè·¯å¾„é€‰æ‹© /rootã€‚
# 2ã€åœ¨ Gitee é¡¹ç›®çš„ æœåŠ¡ -> Gitee Pages ä¸­è®¾ç½®éƒ¨ç½²åˆ†æ”¯ä¸º gh-pagesï¼Œéƒ¨ç½²ç›®å½•åˆ™ä¸ç”¨å¡«ã€‚
# 3ã€åœ¨æœ¬æœºç”µè„‘çš„å‘½ä»¤è¡Œç»ˆç«¯æˆ– Git Bash ä½¿ç”¨å‘½ä»¤ ssh-keygen ç”Ÿæˆ SSH Keyï¼Œè¿ç»­ä¸‰æ¬¡å›è½¦ã€‚ç”Ÿæˆçš„ id_rsa æ˜¯ç§é’¥ï¼Œid_rsa.pub æ˜¯å…¬é’¥ã€‚å¦‚æœå·²ç»ç”Ÿæˆè¿‡åˆ™è·³è¿‡
# 4ã€å°†ç”Ÿæˆçš„ id_rsa.pub å…¬é’¥åˆ†åˆ«é…ç½®åˆ° GitHub å’Œ Gitee è´¦å·çš„ SSH Keys ä¸­ã€‚
    # cat ~/.ssh/id_rsa.pub | wl-copy
    # é…ç½® Gitee å¯†é’¥	https://gitee.com/profile/sshkeys
    # é…ç½® Github å¯†é’¥	https://github.com/settings/keys
# 5ã€åœ¨ GitHub é¡¹ç›®çš„ Settings -> Secrets -> Secrets and variables è·¯å¾„ä¸‹é…ç½®å¥½å‘½åä¸º GITEE_RSA_PRIVATE_KEY å¯†é’¥ã€‚å€¼ä¸º id_rsa ç§é’¥ã€‚
    # cat ~/.ssh/id_rsa | wl-copy
    # åœ¨ Github é…ç½® id_rsa ç§é’¥ã€‚ 	https://github.com/lcqh2635/tauri-bun-ts/settings/secrets/actions